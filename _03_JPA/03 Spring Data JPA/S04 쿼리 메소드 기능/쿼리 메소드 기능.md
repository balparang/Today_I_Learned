# 4-1. 메소드 이름으로 쿼리 생성

### 쿼리 메소드 기능 3가지

- 메소드 이름으로 쿼리 생성
- 메소드 이름으로 JPA NamedQuery 호출
- `@Query` 어노테이션을 사용해서 리포지토리 인터페이스에 쿼리 직접 정의

### 쿼리 메소드 필터 조건

- https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation

### 스프링 데이터 JPA가 제공하는 쿼리 메소드 기능

- 조회: 
  - find...By ,read...By ,query...By get...By
- COUNT
  - count ... by : `long`
- EXISTS
  - exists ... by : `boolean`
- 삭제
  - delete ... by : `long`  
- DISTINCT
  - findDistinct, findMemberDistinctBy
- LIMIT 
  - findFirst3, findFirst, findTop, findTop3
  - https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.limit-query-result

### 조건이 너무 많아지면? 

- 보통 조건 2개까지는 쿼리 메소드로 짠다.
- 조건이 더 추가되면 너무 길어지기 때문에 `JPQL`을 이용한다.

### Spring Data JPA의 큰 장점: 애플리케이션 로딩 시점에 에러발생

- 쿼리 메소드 기능은 엔티티의 필드명이 변경되면 인터페이스에 정의한 이름도 꼭 함께 변경해야한다.
- 그렇지 않으면 애플리케이션 시작하는 시점에 오류가 난다.
- **애플리케이션 로딩 시점에 오류를 인지**하는 것이 Data JPA의 큰 장점


<br>

# 4-2. JPA NamedQuery

> _"실무에서 쓸 일 거의없다. 편하게 들어라."_

### NamedQuery 장점

- NamedQuery 는 기본적으로 정적 쿼리이기 때문에 애플리케이션 로딩 시점에 파싱을 해서 에러를 발생시킬 수 있다.

<br>

# 4-3. @Query, 리포지토리 메소드에 쿼리 정의하기

> _"실무에서 많이 쓰는 기능"_

### 기술 선택 기준

- 간단한 쿼리는 `메소드 이름으로 쿼리 생성` 사용.
- 조금 복잡한 정적 쿼리는 `@Query` 사용.
- 동적 쿼리는 `Querydsl` 사용. 

### 장점: 애플리케이션 로딩 시점에 에러 발생 가능  

- 정적 쿼리 이기 때문에 로딩시점에 파싱을 해서, 문제 있으면 에러를 발생시켜준다.

# 4-4. @Query - 값, DTO 조회하기

## 값 조회하기

```java
// 단순히 값 하나를 조회
@Query("select m.username from Member m")
List<String> findUsernameList();
```

## DTO 조회하기

```java
// DTO로 직접 조회
@Query("select new inf.datajpa.dto.MemberDto(m.id, m.username, t.name) "
    + "from Member m "
    + "join m.team t")
List<MemberDto> findMemberDto();
```

- 내부 조인은 `INNER JOIN` 사용
  - `INNER` 는 생략 가능

<br>

# 4-5. 파라미터 바인딩 

```java
select m from Member m where m.username = ?0 //위치 기반 
select m from Member m where m.username = :name //이름 기반
```

- ~~위치 기반~~
  - _위치 기반은 거의 사용 안 함_
- **이름 기반** 

## 컬렉션 파라미터 바인딩 

```java
@Query("select m from Member m where m.username in :names")
List<Member> findByNames(@Param("names") Collection<String> names);
```

- `Collection` 타입으로 IN 절을 지원한다.
