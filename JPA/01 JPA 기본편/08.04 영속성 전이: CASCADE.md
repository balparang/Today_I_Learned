# 8.4 영속성 전이: CASCADE

- **영속성 전이는 연관관계를 매핑하는 것과는 관련없다.**

## 영속성 전이 사용 안 하는 경우

```java
@Entity
public class Parent {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "parent_id")
    private Long id;

    private String name;

    @OneToMany(mappedBy = "parent")
    private List<Child> children = new ArrayList<>();

    protected Parent() {
    }

    public Parent(final String name) {
        this.name = name;
    }

    public void addChild(final Child child) {
        children.add(child);
        child.setParent(this);
    }
}
```

```java
@Entity
public class Child {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "child_id")
    private Long id;

    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "parent_id")
    private Parent parent;

    public Child() {
    }

    public Child(final String name) {
        this.name = name;
    }

    public void setParent(final Parent parent) {
        this.parent = parent;
    }
}
```

```java
final Child child1 = new Child();
final Child child2 = new Child();

final Parent parent = new Parent();
parent.addChild(child1);
parent.addChild(child2);

em.persist(parent);
em.persist(child1);
em.persist(child2);
```

```sql
Hibernate: 
    insert 
    into
        Parent
        (name, parent_id) 
    values
        (?, default)
Hibernate: 
    insert 
    into
        Child
        (parent_id, child_id) 
    values
        (?, default)
Hibernate: 
    insert 
    into
        Child
        (parent_id, child_id) 
    values
        (?, default)
```

- JPA에서 엔티티를 저장할 때, 연관된 모든 엔티티는 영속 상태여야 한다.
- 따라서 위 예제의 경우 부모 엔티티도 영속 상태로 만들고, 자식 엔티티도 영속 상태로 만들었다.
- 이럴 경우 영속성 전이를 사용하면 연관된 자식 까지 한 번에 영속 상태로 만들 수 있다.

```java
final Child child1 = new Child();
final Child child2 = new Child();

final Parent parent = new Parent();
parent.addChild(child1);
parent.addChild(child2);

em.persist(parent);
```

```sql
Hibernate: 
    insert 
    into
        Parent
        (name, parent_id) 
    values
        (?, default)
```

- 영속성 전이 상태가 없는 경우에서, 부모만 영속 상태이면 자식은 영속상태가 되지 않는다.



