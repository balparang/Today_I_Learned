기본키 생성 전략

- 직접 할당
- 자동 생성: 대리 키 사용 방식
  - `IDENTITY`: 기본 키 생성을 데이터베이스에 위임
  - `SEQUENCE`: 데이터베이스 시퀀스를 사용해서 기본 키를 할당
  - `TABLE`: 키 생성 테이블을 사용
    - 키 생성용 테이블을 하나 만들어두고 마치 시퀀스처럼 사용
    - 테이블을 활용하므로 모든 DB에서 사용 가능


### IDENTITY 전략

- **엔티티를 데이터베이스에 먼저 저장, 이후 식별자를 조회해서 엔티티 식별자에 할당**
- 엔티티가 영속 상태가 되려면 식별자가 필요
  - IDENTITY는 엔티티를 DB에 저장해야 식별자를 구할 수 있으므로, `em.persist()`를 호출하는 즉시 INSERT SQL이 데이터베이스에 전달됨.
  - 👉 트랜잭션을 지원하는 쓰기 지연이 동작하지 않는다.
- 데이터베이스랑 **한 번만 통신**
  - 하이버네이트는 데이터를 저장하면서 동시에 생성된 기본키값을 얻어올 수 있도록 최적해두었음. 
- MySQL, PostgreSQL 등

### SEQUENCE

- **데이터베이스 시퀀스를 사용해서 식별자값을 획득한 후 엔티티에 할당한 후에 영속성 컨텍스트에 저장**. 
  - 이후 트랜잭션 커밋 후 플러시가 일어나서 데이터베이스에 저장됨.
- 데이터베이스와 **2번 통신**
  - 데이터베이스 시퀀스를 통해 **식별자를 조회하는 추가작업**이 필요하기 때문.
- `데이터베이스 시퀀스`
  - 유일한 값을 순서대로 생성하는 특별한 데이터베이스 오브젝트.

- 오라클, PostgreSQL, H2 등

### TABLE 

- **데이터베이스 시퀀스 생성용 테이블에서 식별자 값을 획득한 후 영속성 컨텍스트에 저장.**
- 키 생성 전용 테이블을 하나 만들고, 여기에 이름과 값으로 사용할 컬럼을 만들어 데이터베이스 시퀀스를 흉내내는 전략
- 테이블을 사용하므로 모든 데이터베이스에 적용가능
- 값을 조회하면서 `SELECT`, 그 다음 값으로 증가시키기 위해 `UPDATE` 쿼리 사용함 

### AUTO

- 데이터베이스 방언에 따라 IDENTITY, SEQUENCE, TABLE 전략 중 하나를 자동으로 선택
  - ex) MySQL을 선택하면 IDENTITY가, 오라클을 선택하면 SEQUENCE가 자동으로 선택된다.
- 장점: 데이터베이스를 변경해도 코드를 수정할 필요가 없다.