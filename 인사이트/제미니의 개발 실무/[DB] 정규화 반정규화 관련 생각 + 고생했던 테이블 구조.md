> https://youtu.be/gqOIyrVeV3A?feature=shared

# 요구사항과 케이스를 따져볼 것

- 정규화, 반정규화 기준으로 생각하는 것은 조금 오래되었음.
- DB 설계하는 것 자체를 개념 객체를 뒷받침하는 기준으로 설계를 한다.
  - 기본적으로 정규화가 많이 되어있는 편인 것 같다.
- 반정규화는 요구사항과 케이스가 중요한 것 같다.

---

# 쿠폰 예시 

```text
- 쿠폰 테이블
  - name
- 발급 쿠폰 테이블
  - user_id
  - 쿠폰_id
```

## 상황 예시

### 항상 쿠폰명이 필요한 경우  

- 발급쿠폰에 대한 조회가 엄청 잦은데 항상 쿠폰명이 필요하다고 하자.
  - 👉 발급쿠폰에 `쿠폰명` 컬럼을 넣는다.

### 요구사항: 쿠폰명이 변경될 때, 발급된 쿠폰명은 변경이 안 되면 좋겠다.

```text
- 쿠폰 테이블
  - name
- 발급 쿠폰 테이블
  - user_id
  - 쿠폰_id
  - 쿠폰명
```

- 발급 쿠폰 테이블에 쿠폰명 컬럼 추가

### 요구사항: 쿠폰명이 변경될 때, 발급된 쿠폰명이 같이 변경되면 좋겠다!

- 방법 1
  - 쿠폰_id로 쿠폰을 조회하게 하는게 편리 (쿠폰명 컬럼 X)
- 방법 2
  - 쿠폰 테이블의 name이 변경될 때, 발급 쿠폰의 쿠폰명 업데이트! (쿠폰명 컬럼 O)
  - 👉 만약 A쿠폰에 발급쿠폰이 1억개라면, 이 방법은 너무 비효율적임.

### 결론: 반정규화는 케이스에 따라서.

---

# Order 예시

```text
 - OrderHeader
    - id
    - name
 - OrderDetail
    - id
    - name
 - OrderItem
   - orderHeaderId
   - orderHeaderName
   - orderDetailId
   - orderDetailName
   - id
   - name 
```

- 시간이 지나니까, `OrderHeader`나 `OrderDetail`이 필요한 상황임에도 불구하고 사람들이 전부 `OrderItem`만 쓰게 된다.
- 이 때 OrderItem가 엔티티이자 개념객체여서, 유지보수가 힘든 기억이 있었음.
  - 조심해야겠다라는 생각이 들었음.

---

# 결론: 테이블간의 위상을 생각

- 반정규화든, 정규화든 테이블간에도 위상이 있다.
- 테이블간에도 결국 테이블간의 위상과 응집과 결합이 있다.
  - OrderItem이 OrderHeader를 아는게 위상적으로 맞는가?
- 개념 객체를 설계할때도 당연히 그렇게하지만, 테이블을 설계할 때도 테이블간의 위상, 높낮이, 응집도, 결합(어디서 느슨하게 할지)등을 고민하면서 설계한다.