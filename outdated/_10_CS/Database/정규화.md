# 정규화 

## 정규화란?

- DB설계 과정에서, 잘못 설계된 테이블에 대해 삽입, 삭제, 수정 작업을 하면 이상현상이 발생한다. 이상현상은 DB의 일관성을 훼손하여 `데이터의 무결성`을 깨뜨리는데, 이를 해결하기위해 `함수 종속성`을 파악하여 몇 가지 규칙에 따라 테이블을 분해해야한다. 이와 같이 잘못 설계된 테이블을 수정하여 정상으로 만드는 과정을 정규화라 한다.

## 이상 현상

- 테이블에 투플을 삽입할 때 부득이하게 널 값이 입력되거나, 삭제 시 연쇄삭제 현상이 발생하거나, 수정 시 일관성이 훼손되는 현상


_학생수강 테이블_ 

| 학생번호 | 학생 이름 | 학과   | 주소       | 강좌이름   | 강의실     |
|------|-------|------|----------|--------|---------|
| 501  | 박지성   | 컴퓨터과 | 영국 맨체스타  | 데이터베이스 | 공학관 110 |
| 401  | 김연아   | 체육학과 | 대한민국 서울  | 데이터베이스 | 공학관 110 |
| 402  | 장미란   | 체육학과 | 대한민국 강원도 | 스포츠경영학 | 체육관 103 |
| 502  | 추신수   | 컴퓨터과 | 미국 클리블랜드 | 자료구조   | 공학관 111 |
| 501  | 박지성   | 컴퓨터과 | 영국 맨체스타  | 자료구조   | 공학과 111 |

### 이상 현상 종류

- **삽입 이상**
  - 새로운 투플 삽입 시 특정 속성에 해당하는 값이 없어 널 값을 입력해야하는 현상
  - 집계함수는 NULL값을 제외하고 연산하므로, 집계함수 사용시 의도와 다른 결과를 만들 수 있다. 
  
| 학생번호 | 학생 이름 | 학과   | 주소      | 강좌이름 | 강의실  |
|------|-------|------|---------|------|------|
| ...  | ...   | ... | ... | ... | ... |
| 403  | 박세리   | 체육학과 | 대한민국 대전 | NULL | NULL |


- **갱신 이상**
  - 투플 수정 시 중복된 데이터의 일부만 수정되어 데이터의 불일치 문제가 일어나는 현상

| 학생번호 | 학생 이름 | 학과   | 주소      | 강좌이름   | 강의실     |
|------|-------|------|---------|--------|---------|
| 501  | 박지성   | 컴퓨터과 | 영국 맨체스타 | 데이터베이스 | 공학관 110 |
| 501  | 박지성   | 컴퓨터과 | 대한민국 서울 | 자료구조   | 공학과 111 |


- **삭제 이상**
  - 투플 삭제 시 같이 저장된 다른 정보까지 연쇄적으로 삭제되는 현상.

    | 학생번호 | 학생 이름 | 학과   | 주소       | 강좌이름   | 강의실     |
    |------|-------|------|--------|--------|---------|
    | 402  | 장미란   | 체육학과 | 대한민국 강원도 | 스포츠경영학 | 체육관 103 |
    - 장미란 학생이 스포츠경영학 과목을 취소해서 투플을 삭제했는데 학생이름, 학과, 주소 정보까지 사라진다.  



## 함수 종속성


## 함수 종속 

- 정규화를 수행하려면 먼저 릴레이션을 구성하는 속성들 간의 관련성을 판단할 수 있어야한다. 
- 정규화 과정에서 고려해야하는 속성들 간의 관련성을 `함수적 종속성`(이하 함수 종속성) 이라고 한다.
- 일반적으로 **릴레이션에 함수적 종속성이 하나 존재하도록 정규화**를 통해 릴레이션을 분해한다.


### 함수적으로 종속되어있다

- 릴레이션을 구성하는 속성들의 부분집합을 X, Y라 할 때, 릴레이션 내의 모든 튜플에서 하나의 X값에 대한 Y값이 항상 하나면 `X가 Y를 함수적으로 결정한다` 또는 `Y가 X에 함수적으로 종속되어있다` 라고 한다. 이렇게 함수적으로 종속하는 성질을 `함수 종속성`이라고 한다.

### 완전 함수 종속과 부분 함수 종속

![](https://velog.velcdn.com/images/balparang/post/53ceb145-0c8a-444c-b53d-96e73ea0f5f0/image.png)

_당첨여부는 {고객아이디, 이벤트번호}에 완전 함수 종속 되어있고, 고객이름은 {고객아이디, 이벤트 번호}에 부분 함수 종속되어있다._

- 완전 함수 종속
  - 속성 집합 Y가 속성 집합 X에 함수적으로 종속되어 있지만, 속성 집합 X 전체에 종속된 것이지 일부분에 종속된 것이 아님을 의미
- 부분 함수 종속
  - 속성 집합 Y가 속성 집합 X 전체가 아닌 일부분으로 함수적으로 종속됨을 의미
  - `결정자`가 여러 개의 속성들로 구성되어있어야 한다. 

## 기본 정규형과 정규화 과정

### 정규화 개념 

- 함수 종속성을 이용하여 **릴레이션을 연관성이 있는 속성들로만 구성되도록 분해**해서, 이상 현상이 발생하지 않는 올바른 릴레이션으로 만들어나가는 과정을 `정규화`라고 한다.
- 정규화의 기본 목표는 관련이 없는 함수 종속성은 별개의 릴레이션으로 표현하는 것이다.  

- 기본 정규형: 제 1, 2, 3 정규형 + 보이스 코드 정규형
- 고급 정규형: 제 4, 5 정규형

### 제 1정규형

- **_릴레이션의 모든 속성 값이 원자값을 가지면 제1 정규형이라고 한다._**
- 모든 속성이 원자값을 가지도록 여러개의 튜플로 분리

### 제2 정규형

- **_릴레이션이 제1 정규형이고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속일 때 제2 정규형이라고 한다._**
- PK가 복합키(Composite Primary Key)로 구성된 경우 2차 정규화를 고려해볼 수 있다.  
- 릴레이션의 키가 복합키일 때, 복합키의 일부분이 다른 속성이 결정자인지 여부를 판단하는 것
- 릴레이션의 부분 함수 종속을 제거하고 모든 속성이 기본키에 완전 함수 종속되도록 한다. 

<img src="https://velog.velcdn.com/images/balparang/post/95407aaf-9b30-457b-ab6e-be9dabe4e88a/image.png">

- 제2 정규형에 속하더라도, 이상현상이 발생할 수 있다.
  - 함수 종속성이 여러개면 삽입 이상, 갱신 이상, 삭제 이상 발생 가능하다.
    - bronze 등급을 추가하고 싶은데 개체 무결성 제약조건을 위배한다.

### 제3 정규형

- **_릴레이션이 제2 정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속이 되지 않으면 제3 정규형에 속한다._**
- 릴레이션에서 이행적 함수 종속을 제거해서, 모든 속성이 기본키에 이행적 함수 종속이 되지 않도록 릴레이션을 분해한다. 
- PK에 의존하지 않고, 일반 컬럼에 의존하는 컬럼을 분리한다.

> 💡 `이행적 함수 종속`이란? <br><br>
> <img src="https://velog.velcdn.com/images/balparang/post/4860d6af-e29d-479b-8381-e6a84cae070d/image.png" >
> <br>
> 3개의 속성 집합 X, Y, Z에 대해 X가 Y의 결정자이고 Y가 Z의 결정자인 경우를 이행적 함수 종속 되었다고 한다.


### 보이스/코드(BCNF) 정규형

- **_릴레이션의 함수 종속 관계에서 모든 결정자가 후보키이면 보이스/코드 정규형에 속한다._**

![](https://velog.velcdn.com/images/balparang/post/57db6451-5d36-4f15-aec6-41a41c314e64/image.png)

- 모든 속성이 원자값을 가진다 -> 제1 정규형
- 기본키가 아닌 속성이 기본키(복합키)에 완전 함수 종속된다. -> 제2 정규형
- 기본키가 아닌 속성이 기본키에 이행적 함수 종속되지 않는다. -> 제3 정규형 

![](https://velog.velcdn.com/images/balparang/post/06cd5b0b-cfb7-4413-8f10-771d40db42b7/image.png)

- 결정자 `담당강사번호`는 후보키가 아니다. 

### 무손실 분해 

릴레이션을 분해할 때 `무손실 분해` 규칙을 지키며 분해해야 한다.

**무손실 분해란?**

- 분해된 릴레이션들을 자연 조인하여 분해 전의 릴레이션으로 다시 복원할 수 있어야한다는 규칙
- 릴레이션이 의미상 동등한 릴레이션들로 분해되어야 하고, 릴레이션을 분해했을 때 정보 손실이 발생하지 않아야한다. 
- 분해된 릴레이션의 관계를 유지하기 위해 분해된 릴레이션에 공통 속성을 한 개 이상 둔다.
  - 공통 속성은 분해된 릴레이션을 다시 원래의 릴레이션으로 복원할 때 조인 속성으로 사용한다.  

---

※ Reference

- [제 1-2-3 정규화 & 역정규화 기법 💯 정리](https://inpa.tistory.com/entry/DB-%F0%9F%93%9A-%EC%A0%9C-1-2-3-%EC%A0%95%EA%B7%9C%ED%99%94-%EC%97%AD%EC%A0%95%EA%B7%9C%ED%99%94#%EC%97%AD%EC%A0%95%EA%B7%9C%ED%99%94)
- 데이터베이스 개론 2판 - 김연희 저
- https://dodo000.tistory.com/21

---

## 🗣️ 면접질문 

### Q. 정규화란?

- 테이블이 잘못 설계되면 삽입, 수정, 삭제 연산 시 `이상현상`이 발생
- 속성간의 함수 종속성을 파악하여 테이블을 분리하여 `이상현상`을 제거해나가는 과정 

### Q. 정규화 장단점

- 장점: 이상현상이 없음. 즉 데이터 불일치나 중요한 정보가 연쇄적으로 삭제되는 일을 방지
- 단점: 정규화를 너무 심하게 하면 조인 성능 문제 

### Q. 역정규화를 하는 이유?

역정규화란 정규화를 통해 분리되었던 릴레이션에서 중복을 허용하고 다시 통합하거나 분할하여 구조를 재조정하는 과정입니다. 정규화된 릴레이션은 하나의 릴레이션을 분해하기 때문에 원하는 자료가 하나의 릴레이션에 존재하지 않아 외래키를 이용해 참조해야하는 상황이 잦아집니다. 이는 데이터베이스에 저장된 자료를 검색하는 시간을 증가시키며 성능을 저하시킬 수 있습니다. 따라서 데이터베이스의 물리적 설계 과정에서 성능을 향상시키기 위해 역정규화를 실행합니다. 역정규화의 종류로는 릴레이션 역정규화, 속성 역정규화가 있습니다.