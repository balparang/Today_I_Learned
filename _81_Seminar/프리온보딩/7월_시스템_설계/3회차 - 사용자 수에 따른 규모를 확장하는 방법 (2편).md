# 사용자 수에 따른 규모를 확장하는 방법 - 2 편

>  [학습자료](https://lean-mahogany-686.notion.site/2-54176ae283224389af734cb4699f57b2)

---

# 1. 메시지 큐

## 메시지 큐란?

<img src="https://lean-mahogany-686.notion.site/image/https%3A%2F%2Fuser-images.githubusercontent.com%2F60383031%2F193444234-5f52e5fc-f764-472d-bb08-a5915283c9b7.png?id=5f60df08-c100-4340-af3d-cd66f46ac70e&table=block&spaceId=7ac0bf59-e3bb-4f76-a93b-27f040ec55b6&width=2000&userId=&cache=v2">

- 메시지 큐에 보관된 메시지는 소비자(Consumer)가 꺼낼 때까지 안전히 보장된다는 특성을 보장하는 비동기 통신 매체  

## 장점 

- 메시지 큐를 사용하면 서비스 또는 서버 간 결합이 느슨해진다.
  - 규모 확장성이 보장되어야 하는 안정적인 애플리케이션 구성 가능.
- Producer는 Consumer 프로세스가 다운되어도 메시지를 발행할 수 있고, 그 반대도 가능

## 사용 사례

- 알림 푸쉬 발송, 이메일 발송, 이미지 보정 등 시간이 오래 걸릴 수 있는 프로세스를 비동기적으로 처리한다. 

## 이벤트 큐

- 메시지 큐와 달리 한 번 읽은 데이터가 즉시 삭제 되지 않음
- 현대 애플리케이션에서는 **이벤트 기반 마이크로서비스 아키텍처**를 구현하는데 많이 활용된다.

### 특징

- 단일 진실 공급원
- 장애가 일어난 시점부터 재처리가 가능
- 많은 양의 실시간 데이터를 효율적으로 처리가 가능

> - [카프카, 레빗엠큐, 레디스 큐 차이 - 데브원영](https://www.youtube.com/watch?v=H_DaPyUOeTo)
> - [카프카 설명 - if kakao](https://tv.kakao.com/channel/3150758/cliplink/391419257)

<br>

# 2. 이벤트 기반 마이크로서비스 

## 2.1 이벤트 기반 마이크로서비스란?

<img src="https://lean-mahogany-686.notion.site/image/https%3A%2F%2Fuser-images.githubusercontent.com%2F60383031%2F193445193-b3082bca-fdce-44f9-b95f-64c0fc95a451.png?id=19db9c69-25aa-4258-ae98-0e760d4c9b18&table=block&spaceId=7ac0bf59-e3bb-4f76-a93b-27f040ec55b6&width=2000&userId=&cache=v2">

- 현대 Event Driven MSA 에서는 시스템 이벤트를 생성/소비하는 방식으로 서로 통신
- 이벤트를 소비해도 전달한 시스템에서 바로 사라지지 않고 다른 `Consumer`도 가져갈 수 있게 보존된다.

## 2.2 DDD와 BoundedContext

<img src="https://lean-mahogany-686.notion.site/image/https%3A%2F%2Fuser-images.githubusercontent.com%2F60383031%2F193445856-86fe6ace-ef4a-4fbb-8cba-b16ade117701.png?id=0062fcb7-6b62-47ce-b486-5356823a8c63&table=block&spaceId=7ac0bf59-e3bb-4f76-a93b-27f040ec55b6&width=2000&userId=&cache=v2">

- Bounded Context를 비즈니스 중심으로 설계하면 팀별로 느슨하게 결합하여 고도로 응집된 MSA 가능
  - 덕분에 비즈니스에 필요한 솔루션을 자율적으로 설계/구현 가능(polygot)
- 팀 간의 복잡한 의존관계가 줄어든다.
- 만약에 기술 중심으로 설계하면 모놀리식 시스템과 같은 문제를 겪게 된다.

## 2.3 이벤트 기반 통신 구조

- 요청과 응답 API에 얽매이는 일 없이 이벤트 스트림 내부에 정의된 이벤트 데이터를 매개로 소통
- Producer 는 자신이 맡은 이벤트 스트림에 잘 정의된 데이터를 생산하는 일만 책임지면 된다.
- Consumer 는 이벤트 스트림에서 들어온 데이터를 처리하는 일을 담당한다. 
- 느슨한 결합과 높은 응집도를 추구하는 Bounded Context 원칙을 더 확실히 준수할 수 있다.

## 2.4 동기식 마이크로서비스의 문제점 

> [11번가 Spring Cloud 기반 MSA로의 전환 - 지난 1년간의 이야기](https://www.youtube.com/watch?v=J-VP0WFEQsY)

1. 점대점 결함: 다른 서비스에 의존한다.
2. 의존적 확장: 의존하는 모든 다른 모든 서비스가 확장 가능한지 고려해야함
3. API 버저닝: API 스펙을 변경하는 것은 매우 어렵다.
4. 테스트: 의존하는 서비스까지 통합해서 테스트하기 어렵다.

## MSA는 무조건 좋은가?

- 모놀리식 -> MSA로 전환사례는 많다.
- MSA -> 모놀리식 사례는 잘 없어서 더 눈이더 가더라.

- [잘 키운 모노리스 하나 열 마이크로서비스 안 부럽다 (박용권)](https://www.youtube.com/watch?v=uTSuVFyv81w&ab_channel=WorkerKSUG)


# 5. 처리율 제한

## 5.4 알고리즘

### 토큰 버킷 알고리즘

### 특징 


<br>

# 아하! 모먼트 - 내가 이직을 준비했던 방법

- 공부를 진짜 열심히 한다. <- 포장
  - 언어, 프레임워크, DB, 기타 대용량 처리 등등


- 현업에서 문제를 많이 해결한다.(단순 기능 구현 X)
  - 단순 CRUD는 이력서에 적었을 때, 매력적일까?
  - -> **성능 개선**, 구조 개선 -> 결과: 유지보수 용이해짐, 10s to 1s
  - -> 사내 문화 도임 ex) 코드 리뷰, 테스트 코드
  - 만약에 테스트 코드를 이제부터 만든다??
    - 어떻게?? 단위 테스트 vs 통합 테스트 
    - 통합테스트 ?? 어떻게 ?? -> 도커 띄운다, 자체 인메모리 DB 이런걸 쓴다. (장단점 서로 명확)
    - 근데 나는 ~~~ 선택
  - 해결 과정들을 잘 정리 포장을 잘해야함!!


- 추천: 당연히 둘 다 열심히


- 코테
  - 신입: Hard 리얼 빡세게 해야함
  - 경력: 
    - 좀 느슨하게. 설렁설렁 가능
    - 경력 공채는 이야기가 다름. 수시 채용 한정. 수시 채용 중에는 코테 2/5 솔 해도 통과한 적 있고 안 본 곳도 있음.
  - 과제 전형은 빡세다..
    

- 포폴
  - 따로 준비는 안함
  - 그냥 블로그, 깃헙 정도만 관리 빡세게 했음
  

- 이직 엄청 자주했죠
  - 20년부터 개발 경력 시작 → 22년도 4번째
  - 자주 이직한다고 마이너스 될 수 있지만, 아예 못 하는 건 아님
  - 링크드인 자주 활용
    - 내가 직접 지원하면 거의 **서탈 ㅠ.ㅠ**
    - 리쿠르터 연락 → 거의 면접 감 → 잘 설명 → 합격
    - 면접 기회 오면 다 봄
    

- 빡세게 달리다 보면 당연히 스트레스 오죠
  - 자기만의 방식으로 푸는게 중요 ← 너무 교과서 같은 내용 …
  - ex) 운동, 가끔씩 술, 스터디원들끼리 신세한탄 아 언제 이직하지

    
# Q&A

### 도메인 분석 어떻게? 

- UML은 잘 쓰지 않는다. 
- API 부터 코드 따라가보면서 이해.
- PPT로 개인적으로 정리 해보거나 함.
- DB 테이블 분석 등.